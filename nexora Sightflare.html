<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Corea Starstroupe - Simulation</title>
  <link rel ="icon" href="Credits.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --electric-blue: rgb(63, 159, 255);
      --vivid-purple: rgb(156, 77, 255);
      --hot-pink: rgb(255, 77, 156);
      --magenta: rgb(255, 46, 178);
      --rose-pink: rgb(255, 118, 178);
      --deep-violet: rgb(106, 0, 255);
      --black-base: rgb(0, 0, 0);
      --dark-gray: rgb(15, 15, 15);
      --darker-gray: rgb(25, 25, 25);
      --border-gray: rgb(40, 40, 40);
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.5);
      /* Light mode variables */
      --light-bg: #ffffff;
      --light-text: #000000;
      --light-text-secondary: rgba(0, 0, 0, 0.7);
      --light-text-muted: rgba(0, 0, 0, 0.5);
      --light-border: #e0e0e0;
      --light-dark-gray: #f5f5f5;
      --light-darker-gray: #e0e0e0;
    }

    /* Light mode styles */
    @media (prefers-color-scheme: light) {
      body {
        background: var(--light-bg);
        color: var(--light-text);
      }
      .header {
        background: var(--light-bg);
        border-bottom: 1px solid var(--light-border);
      }
      .sidebar {
        background: var(--light-bg);
        border-right: 1px solid var(--light-border);
      }
      .sidebar-header {
        background: var(--light-bg);
        border-bottom: 1px solid var(--light-border);
      }
      .sidebar-content {
        background: var(--light-bg);
      }
      .parameter-group {
        background: var(--light-bg);
        border-bottom: 1px solid var(--light-border);
      }
      .parameter-value {
        background: var(--light-dark-gray);
        border: 1px solid var(--light-border);
        color: var(--electric-blue);
      }
      .slider {
        background: var(--light-border);
      }
      .chat-container {
        background: var(--light-bg);
      }
      .chat-input-container {
        background: var(--light-bg);
      }
      .chat-input-wrapper {
        border: 1px solid var(--light-border);
      }
      .chat-input {
        color: var(--light-text);
      }
      .chat-input::placeholder {
        color: var(--light-text-muted);
      }
      .message.user .message-text {
        color: var(--light-text);
      }
      .message.ai .message-text {
        color: var(--light-text);
      }
      .message-meta {
        color: var(--light-text-muted);
      }
      .welcome-message {
        color: var(--light-text-muted);
      }
      .modal-overlay {
        background: rgba(0, 0, 0, 0.7);
      }
      .modal {
        background: var(--light-bg);
        border: 1px solid var(--light-border);
      }
      .modal-message {
        color: var(--light-text-secondary);
      }
      .sidebar-overlay {
        background: rgba(0, 0, 0, 0.7);
      }
      .sidebar-close {
        background: var(--light-border);
        color: var(--light-text);
      }
      .mobile-params-toggle {
        background: var(--light-dark-gray);
        border: 1px solid var(--light-border);
        color: var(--light-text);
      }
      .conversation-separator {
        background: var(--electric-blue);
      }
      .file-input-button {
        color: var(--light-text-secondary);
      }
      .file-input-button:hover {
        color: var(--electric-blue);
      }
      .stop-input, select {
        background: var(--light-dark-gray);
        border: 1px solid var(--light-border);
        color: var(--light-text);
      }
      .stop-input::placeholder {
        color: var(--light-text-muted);
      }
      .file-preview {
        color: var(--electric-blue);
      }
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Google Sans', sans-serif;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 0px;
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: transparent;
    }

    * {
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    body {
      background: var(--black-base);
      color: white;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .header {
      background: var(--black-base);
      border-bottom: 1px solid var(--border-gray);
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--electric-blue);
    }

    .logo-image {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background-image: url('Credits.png'), url('/placeholder.svg?height=32&width=32');
      background-size: cover;
      background-position: center;
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      line-height: 1;
    }

    .logo-main {
      font-size: 1.2rem;
      font-weight: 700;
      color: white;
    }

    .logo-sub {
      font-size: 0.7rem;
      font-weight: 400;
      color: var(--text-secondary);
      margin-top: -2px;
    }

    .logo-separator {
      height: 24px;
      width: 1px;
      background: var(--border-gray);
      margin: 0 0.5rem;
    }

    .playground-text {
      font-size: 1rem;
      font-weight: 400;
      color: white;
    }

    .mobile-params-toggle {
      display: none;
      background: var(--dark-gray);
      border: 1px solid var(--border-gray);
      border-radius: 8px;
      color: white;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-size: 0.8rem;
      align-items: center;
      gap: 0.5rem;
    }

    .main-container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .sidebar {
      background: var(--black-base);
      border-right: 1px solid var(--border-gray);
      width: 320px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      flex-shrink: 0;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-gray);
      background: var(--black-base);
      flex-shrink: 0;
    }

    .sidebar-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--vivid-purple);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .sidebar-subtitle {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .sidebar-content {
      flex: 1;
      overflow-y: auto;
      padding: 0;
      background: var(--black-base);
    }

    .parameter-group {
      border-bottom: 1px solid var(--border-gray);
      padding: 1rem 1.5rem;
      background: var(--black-base);
    }

    .parameter-group:last-child {
      border-bottom: none;
    }

    .parameter-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .parameter-label-text {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .parameter-value {
      background: var(--dark-gray);
      border: 1px solid var(--border-gray);
      padding: 0.2rem 0.6rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--electric-blue);
      min-width: 45px;
      text-align: center;
    }

    .slider {
      width: 100%;
      height: 3px;
      border-radius: 1.5px;
      background: var(--border-gray);
      outline: none;
      appearance: none;
    }

    .slider::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--hot-pink);
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--hot-pink);
      cursor: pointer;
      border: none;
    }

    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--black-base);
      overflow: hidden;
      position: relative;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
    }

    .message-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message {
      display: flex;
      gap: 1rem;
      align-items: flex-start;
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .message-avatar.user {
      background: var(--dark-gray);
      color: var(--text-secondary);
    }

    .message-avatar.ai {
      background-image: url('Nexora.png'), url('/placeholder.svg?height=36&width=36');
      background-size: cover;
      background-position: center;
      background-color: transparent;
    }

    .message-content {
      flex: 1;
      min-width: 0;
    }

    .message-text {
      font-size: 0.95rem;
      line-height: 1.6;
      word-wrap: break-word;
    }

    .message.user .message-text {
      color: white;
    }

    .message.ai .message-text {
      color: white;
    }

    .message-image {
      margin-top: 1rem;
      border-radius: 12px;
      max-width: 400px;
      border: 1px solid var(--border-gray);
    }

    .message-meta {
      margin-top: 0.75rem;
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .performance-metrics {
      display: flex;
      gap: 1rem;
    }

    .metric {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .conversation-separator {
      height: 1px;
      background: var(--electric-blue);
      margin: 1rem 0;
      width: 100%;
    }

    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .typing-dots {
      display: flex;
      gap: 0.25rem;
    }

    .typing-dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--vivid-purple);
      animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 60%, 100% { opacity: 0.3; }
      30% { opacity: 1; }
    }

    .chat-input-container {
      padding: 1.5rem;
      background: var(--black-base);
      flex-shrink: 0;
    }

    .chat-input-wrapper {
      max-width: 800px;
      margin: 0 auto;
      border: 1px solid var(--border-gray);
      border-radius: 24px;
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .input-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .input-controls {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }

    .file-input-button {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      transition: color 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .file-input-button:hover {
      color: var(--electric-blue);
    }

    .file-input-wrapper input[type="file"] {
      position: absolute;
      left: -9999px;
    }

    .chat-input {
      background: transparent;
      border: none;
      color: white;
      font-size: 0.95rem;
      resize: none;
      min-height: 24px;
      max-height: 120px;
      outline: none;
      width: 100%;
      padding-top: 2px;
    }

    .chat-input::placeholder {
      color: var(--text-muted);
    }

    .send-button {
      background: var(--hot-pink);
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      font-size: 1.1rem;
      padding: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease;
      min-width: 44px;
      height: 44px;
    }

    .send-button:hover:not(:disabled) {
      background: var(--magenta);
    }

    .send-button:disabled {
      background: var(--border-gray);
      cursor: not-allowed;
    }

    .welcome-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
      padding: 2rem;
      z-index: 1;
    }

    .file-preview {
      font-size: 0.8rem;
      color: var(--electric-blue);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    select, .stop-input {
      background: var(--dark-gray);
      border: 1px solid var(--border-gray);
      border-radius: 6px;
      padding: 0.6rem;
      color: white;
      font-size: 0.8rem;
      width: 100%;
    }

    select option {
      background: var(--dark-gray);
      color: white;
    }

    .stop-input::placeholder {
      color: var(--text-muted);
    }

    /* Custom Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--dark-gray);
      border: 1px solid var(--border-gray);
      border-radius: 16px;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      text-align: center;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .modal-overlay.active .modal {
      transform: scale(1);
    }

    .modal-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--electric-blue);
      margin-bottom: 1rem;
    }

    .modal-message {
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      line-height: 1.5;
    }

    .modal-button {
      background: var(--hot-pink);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.9rem;
      padding: 0.75rem 1.5rem;
      transition: background-color 0.2s ease;
    }

    .modal-button:hover {
      background: var(--magenta);
    }

    /* Mobile sidebar overlay */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
    }

    .sidebar-overlay.active {
      display: block;
    }

    .sidebar-overlay .sidebar {
      position: absolute;
      top: 0;
      left: 0;
      height: 100vh;
      width: 100vw;
      max-width: 400px;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 1001;
      background: var(--black-base);
    }

    .sidebar-overlay.active .sidebar {
      transform: translateX(0);
    }

    .sidebar-close {
      display: none;
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: var(--border-gray);
      border: none;
      border-radius: 8px;
      color: white;
      padding: 0.5rem;
      cursor: pointer;
      font-size: 1.2rem;
      z-index: 1002;
    }

    /* AI response formatting */
    .ai-response {
      white-space: pre-line;
    }

    .ai-response ol, .ai-response ul {
      margin: 1rem 0;
      padding-left: 1.5rem;
    }

    .ai-response li {
      margin: 0.5rem 0;
      line-height: 1.6;
    }

    .ai-response p {
      margin: 1rem 0;
    }

    .ai-response h1, .ai-response h2, .ai-response h3 {
      margin: 1.5rem 0 1rem 0;
      color: var(--electric-blue);
    }

    @media (max-width: 1024px) {
      .main-container {
        flex-direction: column;
      }
      
      .sidebar {
        display: none;
      }
      
      .mobile-params-toggle {
        display: flex;
      }
      
      .sidebar-close {
        display: block;
      }
      
      .header {
        padding: 1rem;
      }
      
      .chat-messages {
        padding: 1rem;
      }
      
      .chat-input-container {
        padding: 1rem;
      }

      .logo-main {
        font-size: 1rem;
      }

      .logo-sub {
        font-size: 0.6rem;
      }

      .playground-text {
        font-size: 0.9rem;
      }
    }

    @media (max-width: 768px) {
      .chat-input-wrapper {
        border-radius: 20px;
        padding: 0.75rem 1rem;
      }
      
      .message {
        gap: 0.75rem;
      }
      
      .message-avatar {
        width: 32px;
        height: 32px;
      }

      .header {
        padding: 0.75rem 1rem;
      }

      .logo-main {
        font-size: 0.9rem;
      }

      .logo-sub {
        font-size: 0.55rem;
      }

      .playground-text {
        font-size: 0.8rem;
      }

      .chat-messages {
        padding: 0.75rem;
        gap: 1rem;
      }

      .chat-input-container {
        padding: 0.75rem;
      }
    }

    @media (max-width: 480px) {
      .header-left {
        gap: 0.5rem;
      }

      .logo-image {
        width: 28px;
        height: 28px;
      }

      .playground-text {
        display: none;
      }

      .logo-separator {
        display: none;
      }

      .mobile-params-toggle {
        font-size: 0.75rem;
        padding: 0.4rem 0.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-left">
      <div class="logo">
        <div class="logo-image"></div>
        <div class="logo-text">
          <div class="logo-main"><strong>COREA</strong></div>
          <div class="logo-sub">STARSTROUPE</div>
        </div>
      </div>
      <div class="logo-separator"></div>
      <div class="playground-text">Testing Waters | Sightflare</div>
    </div>
    <button class="mobile-params-toggle" onclick="toggleSidebar()">
      <span class="material-icons">tune</span>
      Parameters
    </button>
  </div>
  
  <div class="main-container">
    <div class="sidebar">
      <button class="sidebar-close" onclick="toggleSidebar()">
        <span class="material-icons">close</span>
      </button>
      <div class="sidebar-header">
        <div class="sidebar-title">
          <span class="material-icons" style="font-size: 1rem;">tune</span>
          Model Parameters
        </div>
        <div class="sidebar-subtitle">Fine-tune AI behavior</div>
      </div>
      
      <div class="sidebar-content">
        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">thermostat</span>
              <span>Temperature</span>
            </div>
            <span class="parameter-value" id="tempValue">0.6</span>
          </div>
          <input type="range" class="slider" id="temperature" min="0" max="2" step="0.1" value="0.6">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">token</span>
              <span>Max Tokens</span>
            </div>
            <span class="parameter-value" id="maxTokensValue">4096</span>
          </div>
          <input type="range" class="slider" id="maxTokens" min="100" max="8192" step="100" value="4096">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">trending_up</span>
              <span>Top P</span>
            </div>
            <span class="parameter-value" id="topPValue">1</span>
          </div>
          <input type="range" class="slider" id="topP" min="0" max="1" step="0.01" value="1">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">filter_list</span>
              <span>Top K</span>
            </div>
            <span class="parameter-value" id="topKValue">40</span>
          </div>
          <input type="range" class="slider" id="topK" min="1" max="100" step="1" value="40">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">psychology</span>
              <span>Presence Penalty</span>
            </div>
            <span class="parameter-value" id="presencePenaltyValue">0</span>
          </div>
          <input type="range" class="slider" id="presencePenalty" min="-2" max="2" step="0.1" value="0">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">repeat</span>
              <span>Frequency Penalty</span>
            </div>
            <span class="parameter-value" id="frequencyPenaltyValue">0</span>
          </div>
          <input type="range" class="slider" id="frequencyPenalty" min="-2" max="2" step="0.1" value="0">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">stop</span>
              <span>Stop Words</span>
            </div>
          </div>
          <input type="text" class="stop-input" id="stopWords" placeholder="Comma separated">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">settings</span>
              <span>Context Behavior</span>
            </div>
          </div>
          <select id="contextBehavior">
            <option value="none">None</option>
            <option value="truncate">Truncate</option>
            <option value="error">Error</option>
          </select>
        </div>
      </div>
    </div>

    <div class="chat-container">
      <div class="chat-messages" id="chatMessages">
        <div class="welcome-message">
          <strong>nexora Sightflare</strong><br>
          Upload image on Sightflare on Corea. Test that.
        </div>
      </div>
      
      <div class="chat-input-container">
        <div class="chat-input-wrapper">
          <div class="input-section">
            <div class="file-preview" id="filePreview" style="display: none;"></div>
            <textarea class="chat-input" id="messageInput" placeholder="Ask about your image..." rows="1"></textarea>
          </div>
          <div class="input-controls">
            <div class="file-input-wrapper">
              <button class="file-input-button" onclick="document.getElementById('imageInput').click()">
                <span class="material-icons">image</span>
              </button>
              <input type="file" id="imageInput" accept="image/*">
            </div>
            <button class="send-button" id="sendButton" onclick="sendMessage()">
              <span class="material-icons">send</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="sidebar-overlay" id="sidebarOverlay">
    <div class="sidebar">
      <button class="sidebar-close" onclick="toggleSidebar()">
        <span class="material-icons">close</span>
      </button>
      <div class="sidebar-header">
        <div class="sidebar-title">
          <span class="material-icons" style="font-size: 1rem;">tune</span>
          Model Parameters
        </div>
        <div class="sidebar-subtitle">Fine-tune AI behavior</div>
      </div>
      
      <div class="sidebar-content">
        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">thermostat</span>
              <span>Temperature</span>
            </div>
            <span class="parameter-value" id="tempValueMobile">0.6</span>
          </div>
          <input type="range" class="slider" id="temperatureMobile" min="0" max="2" step="0.1" value="0.6">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">token</span>
              <span>Max Tokens</span>
            </div>
            <span class="parameter-value" id="maxTokensValueMobile">4096</span>
          </div>
          <input type="range" class="slider" id="maxTokensMobile" min="100" max="8192" step="100" value="4096">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">trending_up</span>
              <span>Top P</span>
            </div>
            <span class="parameter-value" id="topPValueMobile">1</span>
          </div>
          <input type="range" class="slider" id="topPMobile" min="0" max="1" step="0.01" value="1">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">filter_list</span>
              <span>Top K</span>
            </div>
            <span class="parameter-value" id="topKValueMobile">40</span>
          </div>
          <input type="range" class="slider" id="topKMobile" min="1" max="100" step="1" value="40">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">psychology</span>
              <span>Presence Penalty</span>
            </div>
            <span class="parameter-value" id="presencePenaltyValueMobile">0</span>
          </div>
          <input type="range" class="slider" id="presencePenaltyMobile" min="-2" max="2" step="0.1" value="0">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">repeat</span>
              <span>Frequency Penalty</span>
            </div>
            <span class="parameter-value" id="frequencyPenaltyValueMobile">0</span>
          </div>
          <input type="range" class="slider" id="frequencyPenaltyMobile" min="-2" max="2" step="0.1" value="0">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">stop</span>
              <span>Stop Words</span>
            </div>
          </div>
          <input type="text" class="stop-input" id="stopWordsMobile" placeholder="Comma separated">
        </div>

        <div class="parameter-group">
          <div class="parameter-label">
            <div class="parameter-label-text">
              <span class="material-icons" style="font-size: 0.9rem;">settings</span>
              <span>Context Behavior</span>
            </div>
          </div>
          <select id="contextBehaviorMobile">
            <option value="none">None</option>
            <option value="truncate">Truncate</option>
            <option value="error">Error</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Custom Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-title" id="modalTitle">Notice</div>
      <div class="modal-message" id="modalMessage">This is a custom modal message.</div>
      <button class="modal-button" onclick="closeModal()">OK</button>
    </div>
  </div>

  <script>
    let chatHistory = [];
    let currentImage = null;
    let isProcessing = false;

    // Custom modal functions
    function showModal(title, message) {
      document.getElementById('modalTitle').textContent = title;
      document.getElementById('modalMessage').textContent = message;
      document.getElementById('modalOverlay').classList.add('active');
    }

    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('active');
    }

    // Close modal when clicking outside
    document.getElementById('modalOverlay').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });

    // Sync desktop and mobile parameters
    const parameterPairs = [
      { desktop: 'temperature', mobile: 'temperatureMobile', valueDesktop: 'tempValue', valueMobile: 'tempValueMobile' },
      { desktop: 'maxTokens', mobile: 'maxTokensMobile', valueDesktop: 'maxTokensValue', valueMobile: 'maxTokensValueMobile' },
      { desktop: 'topP', mobile: 'topPMobile', valueDesktop: 'topPValue', valueMobile: 'topPValueMobile' },
      { desktop: 'topK', mobile: 'topKMobile', valueDesktop: 'topKValue', valueMobile: 'topKValueMobile' },
      { desktop: 'presencePenalty', mobile: 'presencePenaltyMobile', valueDesktop: 'presencePenaltyValue', valueMobile: 'presencePenaltyValueMobile' },
      { desktop: 'frequencyPenalty', mobile: 'frequencyPenaltyMobile', valueDesktop: 'frequencyPenaltyValue', valueMobile: 'frequencyPenaltyValueMobile' }
    ];

    parameterPairs.forEach(pair => {
      const desktopSlider = document.getElementById(pair.desktop);
      const mobileSlider = document.getElementById(pair.mobile);
      const desktopValue = document.getElementById(pair.valueDesktop);
      const mobileValue = document.getElementById(pair.valueMobile);
      
      desktopSlider.addEventListener('input', (e) => {
        const value = e.target.value;
        mobileSlider.value = value;
        desktopValue.textContent = value;
        mobileValue.textContent = value;
      });
      
      mobileSlider.addEventListener('input', (e) => {
        const value = e.target.value;
        desktopSlider.value = value;
        desktopValue.textContent = value;
        mobileValue.textContent = value;
      });
    });

    // Sync text inputs
    document.getElementById('stopWords').addEventListener('input', (e) => {
      document.getElementById('stopWordsMobile').value = e.target.value;
    });
    
    document.getElementById('stopWordsMobile').addEventListener('input', (e) => {
      document.getElementById('stopWords').value = e.target.value;
    });
    
    document.getElementById('contextBehavior').addEventListener('change', (e) => {
      document.getElementById('contextBehaviorMobile').value = e.target.value;
    });
    
    document.getElementById('contextBehaviorMobile').addEventListener('change', (e) => {
      document.getElementById('contextBehavior').value = e.target.value;
    });

    function toggleSidebar() {
      const overlay = document.getElementById('sidebarOverlay');
      overlay.classList.toggle('active');
    }

    // File input handling
    document.getElementById('imageInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const filePreview = document.getElementById('filePreview');
      
      if (file) {
        currentImage = file;
        filePreview.innerHTML = `<span class="material-icons" style="font-size: 1rem;">image</span> ${file.name}`;
        filePreview.style.display = 'flex';
      } else {
        currentImage = null;
        filePreview.style.display = 'none';
      }
    });

    // Auto-resize textarea
    document.getElementById('messageInput').addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 120) + 'px';
    });

    // Enter key handling
    document.getElementById('messageInput').addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    function formatAIResponse(text) {
      // Format numbered lists
      text = text.replace(/(\d+\.\s)/g, '\n$1');
      
      // Format bullet points
      text = text.replace(/([•\-\*]\s)/g, '\n$1');
      
      // Add spacing around headers
      text = text.replace(/^(#{1,3}\s.+)$/gm, '\n$1\n');
      
      // Add spacing around paragraphs
      text = text.replace(/\n\n+/g, '\n\n');
      
      return text.trim();
    }

    async function typeMessage(element, text, speed = 10) {
      element.textContent = '';
      for (let i = 0; i < text.length; i++) {
        element.textContent += text[i];
        await new Promise(resolve => setTimeout(resolve, speed));
        element.scrollIntoView({ behavior: 'smooth', block: 'end' });
      }
    }

    function addMessage(type, content, image = null, metrics = null) {
      const chatMessages = document.getElementById('chatMessages');
      const welcomeMessage = chatMessages.querySelector('.welcome-message');
      
      if (welcomeMessage) {
        welcomeMessage.remove();
      }

      const messageGroup = document.createElement('div');
      messageGroup.className = 'message-group';

      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;
      
      const avatarDiv = document.createElement('div');
      avatarDiv.className = `message-avatar ${type}`;
      
      if (type === 'user') {
        avatarDiv.innerHTML = '<span class="material-icons">person</span>';
      } else {
        avatarDiv.style.backgroundImage = 'url("Nexora.png"), url("/placeholder.svg?height=36&width=36")';
      }
      
      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      
      const textDiv = document.createElement('div');
      textDiv.className = 'message-text';
      
      if (type === 'ai') {
        textDiv.className += ' ai-response';
      } else {
        textDiv.textContent = content;
      }
      
      contentDiv.appendChild(textDiv);
      
      if (image) {
        const imageEl = document.createElement('img');
        imageEl.src = image;
        imageEl.className = 'message-image';
        imageEl.alt = 'Uploaded image';
        contentDiv.appendChild(imageEl);
      }
      
      if (metrics) {
        const metaDiv = document.createElement('div');
        metaDiv.className = 'message-meta';
        
        const performanceDiv = document.createElement('div');
        performanceDiv.className = 'performance-metrics';
        
        performanceDiv.innerHTML = `
          <div class="metric">
            <span class="material-icons" style="font-size: 0.7rem;">schedule</span>
            <span>TTF: ${metrics.ttf}ms</span>
          </div>
          <div class="metric">
            <span class="material-icons" style="font-size: 0.7rem;">timer</span>
            <span>${metrics.totalTime}ms</span>
          </div>
          <div class="metric">
            <span class="material-icons" style="font-size: 0.7rem;">token</span>
            <span>${metrics.tokens} tokens</span>
          </div>
        `;
        
        metaDiv.appendChild(performanceDiv);
        contentDiv.appendChild(metaDiv);
      }
      
      messageDiv.appendChild(avatarDiv);
      messageDiv.appendChild(contentDiv);
      messageGroup.appendChild(messageDiv);
      
      chatMessages.appendChild(messageGroup);
      
      if (type === 'ai') {
        typeMessage(textDiv, formatAIResponse(content));
      }
      
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      return messageDiv;
    }

    function addTypingIndicator() {
      const chatMessages = document.getElementById('chatMessages');
      
      const messageGroup = document.createElement('div');
      messageGroup.className = 'message-group';
      messageGroup.id = 'typing-indicator-group';
      
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message ai';
      
      const avatarDiv = document.createElement('div');
      avatarDiv.className = 'message-avatar ai';
      avatarDiv.style.backgroundImage = 'url("Nexora.png"), url("/placeholder.svg?height=36&width=36")';
      
      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      
      const typingDiv = document.createElement('div');
      typingDiv.className = 'typing-indicator';
      typingDiv.innerHTML = `
        <span>Nexora is analyzing</span>
        <div class="typing-dots">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      `;
      
      contentDiv.appendChild(typingDiv);
      messageDiv.appendChild(avatarDiv);
      messageDiv.appendChild(contentDiv);
      messageGroup.appendChild(messageDiv);
      
      chatMessages.appendChild(messageGroup);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function removeTypingIndicator() {
      const typingIndicator = document.getElementById('typing-indicator-group');
      if (typingIndicator) {
        typingIndicator.remove();
      }
    }

    async function sendMessage() {
      if (isProcessing) return;
      
      const messageInput = document.getElementById('messageInput');
      const sendButton = document.getElementById('sendButton');
      const filePreview = document.getElementById('filePreview');
      const message = messageInput.value.trim();
      
      if (!message && !currentImage) {
        return;
      }
      
      if (!currentImage && chatHistory.length === 0) {
        showModal('Image Required', 'Please upload an image first.');
        return;
      }
      
      isProcessing = true;
      sendButton.disabled = true;
      sendButton.innerHTML = '<span class="material-icons">hourglass_empty</span>';
      
      // Add user message
      let imageDataUrl = null;
      if (currentImage) {
        imageDataUrl = await toBase64(currentImage);
        imageDataUrl = `data:${currentImage.type};base64,${imageDataUrl}`;
      }
      
      addMessage('user', message || 'Analyze this image', imageDataUrl);
      
      // Add separator
      const chatMessages = document.getElementById('chatMessages');
      const separator = document.createElement('div');
      separator.className = 'conversation-separator';
      chatMessages.appendChild(separator);
      
      // Clear input
      messageInput.value = '';
      messageInput.style.height = 'auto';
      filePreview.style.display = 'none';
      
      // Add typing indicator
      addTypingIndicator();
      
      try {
        const startTime = Date.now();
        let firstTokenTime = null;
        
        // Prepare request
        const messages = [...chatHistory];
        
        const userMessage = {
          role: "user",
          content: []
        };
        
        if (message) {
          userMessage.content.push({ type: "text", text: message });
        }
        
        if (currentImage) {
          userMessage.content.push({ 
            type: "image_url", 
            image_url: { url: imageDataUrl } 
          });
        }
        
        messages.push(userMessage);
        
        // Collect parameters
        const temperature = parseFloat(document.getElementById('temperature').value);
        const maxTokens = parseInt(document.getElementById('maxTokens').value);
        const topP = parseFloat(document.getElementById('topP').value);
        const topK = parseInt(document.getElementById('topK').value);
        const presencePenalty = parseFloat(document.getElementById('presencePenalty').value);
        const frequencyPenalty = parseFloat(document.getElementById('frequencyPenalty').value);
        const stopWords = document.getElementById('stopWords').value.trim();
        
        const stop = stopWords ? stopWords.split(',').map(s => s.trim()).filter(s => s) : undefined;
        
        const requestBody = {
          model: "accounts/fireworks/models/firesearch-ocr-v6",
          messages: messages,
          temperature: temperature,
          max_tokens: maxTokens,
          top_p: topP,
          top_k: topK,
          presence_penalty: presencePenalty,
          frequency_penalty: frequencyPenalty
        };
        
        if (stop && stop.length > 0) {
          requestBody.stop = stop;
        }
        
        const response = await fetch("https://api.fireworks.ai/inference/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": "Bearer fw_3ZWXAxAD6BWE4pgQkvkAqem3",
            "Content-Type": "application/json"
          },
          body: JSON.stringify(requestBody)
        });
        
        if (!firstTokenTime) {
          firstTokenTime = Date.now();
        }
        
        const data = await response.json();
        const reply = data.choices?.[0]?.message?.content;
        const endTime = Date.now();
        
        removeTypingIndicator();
        
        if (reply) {
          // Calculate metrics
          const metrics = {
            ttf: firstTokenTime - startTime,
            totalTime: endTime - startTime,
            tokens: data.usage?.completion_tokens || reply.split(' ').length
          };
          
          // Add separator before AI response
          const separator = document.createElement('div');
          separator.className = 'conversation-separator';
          chatMessages.appendChild(separator);
          
          addMessage('ai', reply, null, metrics);
          
          // Update chat history
          chatHistory.push(userMessage);
          chatHistory.push({
            role: "assistant",
            content: reply
          });
          
          // Clear current image after first use
          if (currentImage) {
            currentImage = null;
            document.getElementById('imageInput').value = '';
          }
        } else {
          addMessage('ai', 'Sorry, I couldn\'t process your request. Please try again.');
        }
        
      } catch (error) {
        removeTypingIndicator();
        addMessage('ai', `Error: ${error.message}`);
      } finally {
        isProcessing = false;
        sendButton.disabled = false;
        sendButton.innerHTML = '<span class="material-icons">send</span>';
        messageInput.focus();
      }
    }

    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Close sidebar when clicking outside
    document.getElementById('sidebarOverlay').addEventListener('click', function(e) {
      if (e.target === this) {
        toggleSidebar();
      }
    });
  </script>
</body>
</html>